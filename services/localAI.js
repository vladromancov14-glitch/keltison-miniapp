// –õ–æ–∫–∞–ª—å–Ω–∞—è –∑–∞–º–µ–Ω–∞ OpenAI API –¥–ª—è –†–æ—Å—Å–∏–∏
const db = require('../config/database');

// –ü—Ä–æ—Å—Ç–æ–π –ò–ò –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö API
class LocalAI {
  constructor() {
    this.responses = {
      '–Ω–µ –∑–∞—Ä—è–∂–∞–µ—Ç—Å—è': [
        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞–±–µ–ª—å –∑–∞—Ä—è–¥–∫–∏ –∏ –∞–¥–∞–ø—Ç–µ—Ä',
        '–û—á–∏—Å—Ç–∏—Ç–µ —Ä–∞–∑—ä–µ–º –æ—Ç –ø—ã–ª–∏ –∏ –≥—Ä—è–∑–∏',
        '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∫–∞–±–µ–ª—å –∏–ª–∏ –∞–¥–∞–ø—Ç–µ—Ä',
        '–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ'
      ],
      '—Ä–∞–∑–±–∏—Ç —ç–∫—Ä–∞–Ω': [
        '–û—Å—Ç–æ—Ä–æ–∂–Ω–æ –æ–±–µ—Ä–Ω–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ –ø–ª–µ–Ω–∫—É',
        '–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–º —ç–∫—Ä–∞–Ω–æ–º',
        '–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Ü–µ–Ω—Ç—Ä',
        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–∞—Ä–∞–Ω—Ç–∏—é —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞'
      ],
      '–º–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç': [
        '–ó–∞–∫—Ä–æ–π—Ç–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è',
        '–û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π',
        '–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ',
        '–û—Å–≤–æ–±–æ–¥–∏—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ'
      ],
      '–Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è': [
        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞—Ä—è–¥–∫—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞',
        '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É',
        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–Ω–æ–ø–∫—É –ø–∏—Ç–∞–Ω–∏—è',
        '–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Ü–µ–Ω—Ç—Ä'
      ]
    };
  }

  async generateResponse(message, context) {
    const lowerMessage = message.toLowerCase();
    
    // –ü–æ–∏—Å–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
    for (const [keyword, responses] of Object.entries(this.responses)) {
      if (lowerMessage.includes(keyword)) {
        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
        
        return {
          message: `üß∞ –ú–∞—Å—Ç–µ—Ä –ö–Å–õ–¢–ò–°–û–ù:\n\n–î–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã "${keyword}":\n\n‚Ä¢ ${randomResponse}\n\n–†–µ–∫–æ–º–µ–Ω–¥—É—é —Ç–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—à–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–µ–º–æ–Ω—Ç—É!`,
          metadata: {
            context: { ...context, keyword },
            local_ai: true,
            instructions_found: 0
          },
          suggestions: [
            '–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–µ–º–æ–Ω—Ç—É',
            '–ù–∞–π—Ç–∏ —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Ü–µ–Ω—Ç—Ä',
            '–ì–¥–µ –∫—É–ø–∏—Ç—å –∑–∞–ø—á–∞—Å—Ç–∏'
          ]
        };
      }
    }

    // –û–±—â–∏–π –æ—Ç–≤–µ—Ç
    return {
      message: 'üß∞ –ú–∞—Å—Ç–µ—Ä –ö–Å–õ–¢–ò–°–û–ù:\n\n–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ, –∏ —è –ø–æ–º–æ–≥—É –Ω–∞–π—Ç–∏ —Ä–µ—à–µ–Ω–∏–µ!\n\n–ú–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å:\n‚Ä¢ –¢–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞\n‚Ä¢ –ú–∞—Ä–∫—É –∏ –º–æ–¥–µ–ª—å\n‚Ä¢ –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç',
      metadata: {
        context: { ...context, general_query: true },
        local_ai: true,
        instructions_found: 0
      },
      suggestions: [
        '–ù–µ –∑–∞—Ä—è–∂–∞–µ—Ç—Å—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ',
        '–†–∞–∑–±–∏—Ç —ç–∫—Ä–∞–Ω',
        '–ú–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç',
        '–ù–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è'
      ]
    };
  }
}

module.exports = new LocalAI();
