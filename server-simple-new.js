const express = require('express');
const cors = require('cors');
const helmet = require('helmet');
const morgan = require('morgan');
const path = require('path');
require('dotenv').config();

const app = express();
const PORT = process.env.PORT || 3004;

// Middleware
app.use(helmet({
  contentSecurityPolicy: {
    directives: {
      defaultSrc: ["'self'"],
      styleSrc: ["'self'", "'unsafe-inline'", "https://telegram.org"],
      scriptSrc: ["'self'", "https://telegram.org"],
      imgSrc: ["'self'", "data:", "https:", "blob:"],
      connectSrc: ["'self'", "https://api.telegram.org"],
      frameSrc: ["'self'", "https://telegram.org"],
      baseUri: ["'self'"],
      fontSrc: ["'self'", "https:", "data:"],
      formAction: ["'self'"],
      frameAncestors: ["'self'"],
      objectSrc: ["'none'"],
      scriptSrcAttr: ["'none'"],
      upgradeInsecureRequests: []
    }
  },
  crossOriginOpenerPolicy: { policy: "same-origin" },
  crossOriginResourcePolicy: { policy: "same-origin" },
  originAgentCluster: true
}));

app.use(cors());
app.use(morgan('combined'));
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Static files with no cache for development
app.use(express.static(path.join(__dirname, 'public'), {
  setHeaders: (res, path) => {
    res.set('Cache-Control', 'no-cache, no-store, must-revalidate');
    res.set('Pragma', 'no-cache');
    res.set('Expires', '0');
  }
}));

// –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
app.get('/', (req, res) => {
  res.sendFile(path.join(__dirname, 'public', 'index.html'));
});

// Mock API endpoints
app.get('/api/categories', (req, res) => {
  res.json([
    { id: 1, name: '–¢–µ–ª–µ—Ñ–æ–Ω', icon: 'üì±', description: '–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã –∏ –º–æ–±–∏–ª—å–Ω—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã' },
    { id: 2, name: '–ù–æ—É—Ç–±—É–∫', icon: 'üíª', description: '–ü–æ—Ä—Ç–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã' },
    { id: 3, name: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞', icon: 'üß∫', description: '–°—Ç–∏—Ä–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã' },
    { id: 4, name: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫', icon: '‚ùÑÔ∏è', description: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∏' },
    { id: 5, name: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞', icon: 'üî•', description: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤—ã–µ –ø–µ—á–∏' },
    { id: 6, name: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞', icon: 'üçΩÔ∏è', description: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω—ã–µ –º–∞—à–∏–Ω—ã' },
    { id: 7, name: '–¢–µ–ª–µ–≤–∏–∑–æ—Ä', icon: 'üì∫', description: '–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã –∏ –º–æ–Ω–∏—Ç–æ—Ä—ã' }
  ]);
});

app.get('/api/brands', (req, res) => {
  const categoryId = req.query.category_id;
  
  let brands = [];
  
  if (categoryId === '1') { // –¢–µ–ª–µ—Ñ–æ–Ω—ã
    brands = [
      { id: 1, name: 'Apple', logo_url: 'https://logo.clearbit.com/apple.com', website: 'https://apple.com' },
      { id: 2, name: 'Samsung', logo_url: 'https://logo.clearbit.com/samsung.com', website: 'https://samsung.com' },
      { id: 3, name: 'Xiaomi', logo_url: 'https://logo.clearbit.com/mi.com', website: 'https://mi.com' },
      { id: 4, name: 'Huawei', logo_url: 'https://logo.clearbit.com/huawei.com', website: 'https://huawei.com' }
    ];
  } else if (categoryId === '2') { // –ù–æ—É—Ç–±—É–∫–∏
    brands = [
      { id: 5, name: 'Apple', logo_url: 'https://logo.clearbit.com/apple.com', website: 'https://apple.com' },
      { id: 6, name: 'Lenovo', logo_url: 'https://logo.clearbit.com/lenovo.com', website: 'https://lenovo.com' },
      { id: 7, name: 'ASUS', logo_url: 'https://logo.clearbit.com/asus.com', website: 'https://asus.com' },
      { id: 8, name: 'HP', logo_url: 'https://logo.clearbit.com/hp.com', website: 'https://hp.com' }
    ];
  } else if (categoryId === '3') { // –°—Ç–∏—Ä–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã
    brands = [
      { id: 9, name: 'Bosch', logo_url: 'https://logo.clearbit.com/bosch.com', website: 'https://bosch.com' },
      { id: 10, name: 'Samsung', logo_url: 'https://logo.clearbit.com/samsung.com', website: 'https://samsung.com' },
      { id: 11, name: 'LG', logo_url: 'https://logo.clearbit.com/lg.com', website: 'https://lg.com' },
      { id: 12, name: 'Whirlpool', logo_url: 'https://logo.clearbit.com/whirlpool.com', website: 'https://whirlpool.com' }
    ];
  } else if (categoryId === '4') { // –•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∏
    brands = [
      { id: 13, name: 'Bosch', logo_url: 'https://logo.clearbit.com/bosch.com', website: 'https://bosch.com' },
      { id: 14, name: 'Samsung', logo_url: 'https://logo.clearbit.com/samsung.com', website: 'https://samsung.com' },
      { id: 15, name: 'LG', logo_url: 'https://logo.clearbit.com/lg.com', website: 'https://lg.com' },
      { id: 16, name: 'Whirlpool', logo_url: 'https://logo.clearbit.com/whirlpool.com', website: 'https://whirlpool.com' }
    ];
  } else if (categoryId === '5') { // –ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∏
    brands = [
      { id: 17, name: 'Samsung', logo_url: 'https://logo.clearbit.com/samsung.com', website: 'https://samsung.com' },
      { id: 18, name: 'LG', logo_url: 'https://logo.clearbit.com/lg.com', website: 'https://lg.com' },
      { id: 19, name: 'Panasonic', logo_url: 'https://logo.clearbit.com/panasonic.com', website: 'https://panasonic.com' },
      { id: 20, name: 'Sharp', logo_url: 'https://logo.clearbit.com/sharp.com', website: 'https://sharp.com' }
    ];
  } else if (categoryId === '6') { // –ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω—ã–µ –º–∞—à–∏–Ω—ã
    brands = [
      { id: 21, name: 'Bosch', logo_url: 'https://logo.clearbit.com/bosch.com', website: 'https://bosch.com' },
      { id: 22, name: 'Siemens', logo_url: 'https://logo.clearbit.com/siemens.com', website: 'https://siemens.com' },
      { id: 23, name: 'Electrolux', logo_url: 'https://logo.clearbit.com/electrolux.com', website: 'https://electrolux.com' },
      { id: 24, name: 'Candy', logo_url: 'https://logo.clearbit.com/candy.com', website: 'https://candy.com' }
    ];
  } else if (categoryId === '7') { // –¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã
    brands = [
      { id: 25, name: 'Samsung', logo_url: 'https://logo.clearbit.com/samsung.com', website: 'https://samsung.com' },
      { id: 26, name: 'LG', logo_url: 'https://logo.clearbit.com/lg.com', website: 'https://lg.com' },
      { id: 27, name: 'Sony', logo_url: 'https://logo.clearbit.com/sony.com', website: 'https://sony.com' },
      { id: 28, name: 'TCL', logo_url: 'https://logo.clearbit.com/tcl.com', website: 'https://tcl.com' }
    ];
  } else {
    // –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    brands = [
      { id: 1, name: 'Apple', logo_url: 'https://logo.clearbit.com/apple.com', website: 'https://apple.com' },
      { id: 2, name: 'Samsung', logo_url: 'https://logo.clearbit.com/samsung.com', website: 'https://samsung.com' },
      { id: 3, name: 'Xiaomi', logo_url: 'https://logo.clearbit.com/mi.com', website: 'https://mi.com' },
      { id: 4, name: 'Huawei', logo_url: 'https://logo.clearbit.com/huawei.com', website: 'https://huawei.com' }
    ];
  }
  
  res.json(brands);
});

app.get('/api/models', (req, res) => {
  const brandId = req.query.brand_id;
  const categoryId = req.query.category_id;
  
  let models = [];
  
  // –¢–µ–ª–µ—Ñ–æ–Ω—ã
  if (categoryId === '1') {
    if (brandId === '1') { // Apple —Ç–µ–ª–µ—Ñ–æ–Ω—ã
      models = [
        { id: 1, brand_id: 1, category_id: 1, name: 'iPhone 14', description: '–§–ª–∞–≥–º–∞–Ω—Å–∫–∏–π —Å–º–∞—Ä—Ç—Ñ–æ–Ω Apple', brand_name: 'Apple', category_name: '–¢–µ–ª–µ—Ñ–æ–Ω' },
        { id: 2, brand_id: 1, category_id: 1, name: 'iPhone 13', description: '–ü—Ä–µ–¥—ã–¥—É—â–µ–µ –ø–æ–∫–æ–ª–µ–Ω–∏–µ iPhone', brand_name: 'Apple', category_name: '–¢–µ–ª–µ—Ñ–æ–Ω' },
        { id: 3, brand_id: 1, category_id: 1, name: 'iPhone SE', description: '–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π iPhone', brand_name: 'Apple', category_name: '–¢–µ–ª–µ—Ñ–æ–Ω' }
      ];
    } else if (brandId === '2') { // Samsung —Ç–µ–ª–µ—Ñ–æ–Ω—ã
      models = [
        { id: 4, brand_id: 2, category_id: 1, name: 'Galaxy S23', description: '–§–ª–∞–≥–º–∞–Ω—Å–∫–∏–π —Å–º–∞—Ä—Ç—Ñ–æ–Ω Samsung', brand_name: 'Samsung', category_name: '–¢–µ–ª–µ—Ñ–æ–Ω' },
        { id: 5, brand_id: 2, category_id: 1, name: 'Galaxy A54', description: '–°—Ä–µ–¥–Ω–∏–π –∫–ª–∞—Å—Å Samsung', brand_name: 'Samsung', category_name: '–¢–µ–ª–µ—Ñ–æ–Ω' },
        { id: 6, brand_id: 2, category_id: 1, name: 'Galaxy Note', description: 'Samsung —Å S-Pen', brand_name: 'Samsung', category_name: '–¢–µ–ª–µ—Ñ–æ–Ω' }
      ];
    } else if (brandId === '3') { // Xiaomi —Ç–µ–ª–µ—Ñ–æ–Ω—ã
      models = [
        { id: 7, brand_id: 3, category_id: 1, name: 'Redmi Note 12', description: '–ü–æ–ø—É–ª—è—Ä–Ω—ã–π —Å–º–∞—Ä—Ç—Ñ–æ–Ω Xiaomi', brand_name: 'Xiaomi', category_name: '–¢–µ–ª–µ—Ñ–æ–Ω' },
        { id: 8, brand_id: 3, category_id: 1, name: 'Mi 13', description: '–§–ª–∞–≥–º–∞–Ω—Å–∫–∏–π Xiaomi', brand_name: 'Xiaomi', category_name: '–¢–µ–ª–µ—Ñ–æ–Ω' }
      ];
    } else if (brandId === '4') { // Huawei —Ç–µ–ª–µ—Ñ–æ–Ω—ã
      models = [
        { id: 9, brand_id: 4, category_id: 1, name: 'P60 Pro', description: '–§–ª–∞–≥–º–∞–Ω—Å–∫–∏–π Huawei', brand_name: 'Huawei', category_name: '–¢–µ–ª–µ—Ñ–æ–Ω' },
        { id: 10, brand_id: 4, category_id: 1, name: 'Nova 11', description: '–°—Ä–µ–¥–Ω–∏–π –∫–ª–∞—Å—Å Huawei', brand_name: 'Huawei', category_name: '–¢–µ–ª–µ—Ñ–æ–Ω' }
      ];
    }
  }
  // –ù–æ—É—Ç–±—É–∫–∏
  else if (categoryId === '2') {
    if (brandId === '5') { // Apple –Ω–æ—É—Ç–±—É–∫–∏
      models = [
        { id: 11, brand_id: 5, category_id: 2, name: 'MacBook Pro 14"', description: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –Ω–æ—É—Ç–±—É–∫ Apple', brand_name: 'Apple', category_name: '–ù–æ—É—Ç–±—É–∫' },
        { id: 12, brand_id: 5, category_id: 2, name: 'MacBook Air M2', description: '–õ–µ–≥–∫–∏–π –Ω–æ—É—Ç–±—É–∫ Apple', brand_name: 'Apple', category_name: '–ù–æ—É—Ç–±—É–∫' }
      ];
    } else if (brandId === '6') { // Lenovo –Ω–æ—É—Ç–±—É–∫–∏
      models = [
        { id: 13, brand_id: 6, category_id: 2, name: 'ThinkPad X1', description: '–ë–∏–∑–Ω–µ—Å –Ω–æ—É—Ç–±—É–∫ Lenovo', brand_name: 'Lenovo', category_name: '–ù–æ—É—Ç–±—É–∫' },
        { id: 14, brand_id: 6, category_id: 2, name: 'IdeaPad Gaming', description: '–ò–≥—Ä–æ–≤–æ–π –Ω–æ—É—Ç–±—É–∫ Lenovo', brand_name: 'Lenovo', category_name: '–ù–æ—É—Ç–±—É–∫' }
      ];
    } else if (brandId === '7') { // ASUS –Ω–æ—É—Ç–±—É–∫–∏
      models = [
        { id: 15, brand_id: 7, category_id: 2, name: 'ROG Strix', description: '–ò–≥—Ä–æ–≤–æ–π –Ω–æ—É—Ç–±—É–∫ ASUS', brand_name: 'ASUS', category_name: '–ù–æ—É—Ç–±—É–∫' },
        { id: 16, brand_id: 7, category_id: 2, name: 'ZenBook Pro', description: '–ü—Ä–µ–º–∏—É–º –Ω–æ—É—Ç–±—É–∫ ASUS', brand_name: 'ASUS', category_name: '–ù–æ—É—Ç–±—É–∫' }
      ];
    } else if (brandId === '8') { // HP –Ω–æ—É—Ç–±—É–∫–∏
      models = [
        { id: 17, brand_id: 8, category_id: 2, name: 'Pavilion Gaming', description: '–ò–≥—Ä–æ–≤–æ–π –Ω–æ—É—Ç–±—É–∫ HP', brand_name: 'HP', category_name: '–ù–æ—É—Ç–±—É–∫' },
        { id: 18, brand_id: 8, category_id: 2, name: 'EliteBook', description: '–ë–∏–∑–Ω–µ—Å –Ω–æ—É—Ç–±—É–∫ HP', brand_name: 'HP', category_name: '–ù–æ—É—Ç–±—É–∫' }
      ];
    }
  }
  // –°—Ç–∏—Ä–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã
  else if (categoryId === '3') {
    if (brandId === '9') { // Bosch —Å—Ç–∏—Ä–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã
      models = [
        { id: 19, brand_id: 9, category_id: 3, name: 'WAU28PH9', description: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ Bosch', brand_name: 'Bosch', category_name: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞' },
        { id: 20, brand_id: 9, category_id: 3, name: 'WAU28PH8', description: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ Bosch', brand_name: 'Bosch', category_name: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞' }
      ];
    } else if (brandId === '10') { // Samsung —Å—Ç–∏—Ä–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã
      models = [
        { id: 21, brand_id: 10, category_id: 3, name: 'WW90T4540AE', description: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ Samsung', brand_name: 'Samsung', category_name: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞' },
        { id: 22, brand_id: 10, category_id: 3, name: 'WW80T4540AE', description: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ Samsung', brand_name: 'Samsung', category_name: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞' }
      ];
    } else if (brandId === '11') { // LG —Å—Ç–∏—Ä–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã
      models = [
        { id: 23, brand_id: 11, category_id: 3, name: 'F4V909W4E', description: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ LG', brand_name: 'LG', category_name: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞' },
        { id: 24, brand_id: 11, category_id: 3, name: 'F4V909W4T', description: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ LG', brand_name: 'LG', category_name: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞' }
      ];
    } else if (brandId === '12') { // Whirlpool —Å—Ç–∏—Ä–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã
      models = [
        { id: 25, brand_id: 12, category_id: 3, name: 'W7M849WH', description: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ Whirlpool', brand_name: 'Whirlpool', category_name: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞' },
        { id: 26, brand_id: 12, category_id: 3, name: 'W7M849WH', description: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ Whirlpool', brand_name: 'Whirlpool', category_name: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞' }
      ];
    }
  }
  // –•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∏
  else if (categoryId === '4') {
    if (brandId === '13') { // Bosch —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∏
      models = [
        { id: 27, brand_id: 13, category_id: 4, name: 'KGN39VLEA', description: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ Bosch', brand_name: 'Bosch', category_name: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫' },
        { id: 28, brand_id: 13, category_id: 4, name: 'KGN39VLEB', description: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ Bosch', brand_name: 'Bosch', category_name: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫' }
      ];
    } else if (brandId === '14') { // Samsung —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∏
      models = [
        { id: 29, brand_id: 14, category_id: 4, name: 'RF28K9070SG', description: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ Samsung', brand_name: 'Samsung', category_name: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫' },
        { id: 30, brand_id: 14, category_id: 4, name: 'RF28K9070SG', description: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ Samsung', brand_name: 'Samsung', category_name: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫' }
      ];
    } else if (brandId === '15') { // LG —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∏
      models = [
        { id: 31, brand_id: 15, category_id: 4, name: 'GSL760PZXV', description: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ LG', brand_name: 'LG', category_name: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫' },
        { id: 32, brand_id: 15, category_id: 4, name: 'GSL760PZXV', description: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ LG', brand_name: 'LG', category_name: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫' }
      ];
    } else if (brandId === '16') { // Whirlpool —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∏
      models = [
        { id: 33, brand_id: 16, category_id: 4, name: 'W7M849WH', description: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ Whirlpool', brand_name: 'Whirlpool', category_name: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫' },
        { id: 34, brand_id: 16, category_id: 4, name: 'W7M849WH', description: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ Whirlpool', brand_name: 'Whirlpool', category_name: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫' }
      ];
    }
  }
  // –ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∏
  else if (categoryId === '5') {
    if (brandId === '17') { // Samsung –º–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∏
      models = [
        { id: 35, brand_id: 17, category_id: 5, name: 'MW23K3515AS', description: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞ Samsung', brand_name: 'Samsung', category_name: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞' },
        { id: 36, brand_id: 17, category_id: 5, name: 'MW23K3515AS', description: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞ Samsung', brand_name: 'Samsung', category_name: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞' }
      ];
    } else if (brandId === '18') { // LG –º–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∏
      models = [
        { id: 37, brand_id: 18, category_id: 5, name: 'MS2042DB', description: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞ LG', brand_name: 'LG', category_name: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞' },
        { id: 38, brand_id: 18, category_id: 5, name: 'MS2042DB', description: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞ LG', brand_name: 'LG', category_name: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞' }
      ];
    } else if (brandId === '19') { // Panasonic –º–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∏
      models = [
        { id: 39, brand_id: 19, category_id: 5, name: 'NN-ST45KW', description: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞ Panasonic', brand_name: 'Panasonic', category_name: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞' },
        { id: 40, brand_id: 19, category_id: 5, name: 'NN-ST45KW', description: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞ Panasonic', brand_name: 'Panasonic', category_name: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞' }
      ];
    } else if (brandId === '20') { // Sharp –º–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∏
      models = [
        { id: 41, brand_id: 20, category_id: 5, name: 'R-642INW', description: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞ Sharp', brand_name: 'Sharp', category_name: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞' },
        { id: 42, brand_id: 20, category_id: 5, name: 'R-642INW', description: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞ Sharp', brand_name: 'Sharp', category_name: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞' }
      ];
    }
  }
  // –ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω—ã–µ –º–∞—à–∏–Ω—ã
  else if (categoryId === '6') {
    if (brandId === '21') { // Bosch –ø–æ—Å—É–¥–æ–º–æ–µ—á–Ω—ã–µ –º–∞—à–∏–Ω—ã
      models = [
        { id: 43, brand_id: 21, category_id: 6, name: 'SMS46IW08E', description: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞ Bosch', brand_name: 'Bosch', category_name: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞' },
        { id: 44, brand_id: 21, category_id: 6, name: 'SMS46IW08E', description: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞ Bosch', brand_name: 'Bosch', category_name: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞' }
      ];
    } else if (brandId === '22') { // Siemens –ø–æ—Å—É–¥–æ–º–æ–µ—á–Ω—ã–µ –º–∞—à–∏–Ω—ã
      models = [
        { id: 45, brand_id: 22, category_id: 6, name: 'SN25I831TE', description: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞ Siemens', brand_name: 'Siemens', category_name: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞' },
        { id: 46, brand_id: 22, category_id: 6, name: 'SN25I831TE', description: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞ Siemens', brand_name: 'Siemens', category_name: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞' }
      ];
    } else if (brandId === '23') { // Electrolux –ø–æ—Å—É–¥–æ–º–æ–µ—á–Ω—ã–µ –º–∞—à–∏–Ω—ã
      models = [
        { id: 47, brand_id: 23, category_id: 6, name: 'ESF9452LOX', description: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞ Electrolux', brand_name: 'Electrolux', category_name: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞' },
        { id: 48, brand_id: 23, category_id: 6, name: 'ESF9452LOX', description: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞ Electrolux', brand_name: 'Electrolux', category_name: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞' }
      ];
    } else if (brandId === '24') { // Candy –ø–æ—Å—É–¥–æ–º–æ–µ—á–Ω—ã–µ –º–∞—à–∏–Ω—ã
      models = [
        { id: 49, brand_id: 24, category_id: 6, name: 'CDP 2L952 W', description: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞ Candy', brand_name: 'Candy', category_name: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞' },
        { id: 50, brand_id: 24, category_id: 6, name: 'CDP 2L952 W', description: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞ Candy', brand_name: 'Candy', category_name: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞' }
      ];
    }
  }
  // –¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã
  else if (categoryId === '7') {
    if (brandId === '25') { // Samsung —Ç–µ–ª–µ–≤–∏–∑–æ—Ä—ã
      models = [
        { id: 51, brand_id: 25, category_id: 7, name: 'QLED Q80C', description: '–¢–µ–ª–µ–≤–∏–∑–æ—Ä Samsung QLED', brand_name: 'Samsung', category_name: '–¢–µ–ª–µ–≤–∏–∑–æ—Ä' },
        { id: 52, brand_id: 25, category_id: 7, name: 'Neo QLED QN90C', description: '–ü—Ä–µ–º–∏—É–º —Ç–µ–ª–µ–≤–∏–∑–æ—Ä Samsung', brand_name: 'Samsung', category_name: '–¢–µ–ª–µ–≤–∏–∑–æ—Ä' }
      ];
    } else if (brandId === '26') { // LG —Ç–µ–ª–µ–≤–∏–∑–æ—Ä—ã
      models = [
        { id: 53, brand_id: 26, category_id: 7, name: 'OLED C3', description: 'OLED —Ç–µ–ª–µ–≤–∏–∑–æ—Ä LG', brand_name: 'LG', category_name: '–¢–µ–ª–µ–≤–∏–∑–æ—Ä' },
        { id: 54, brand_id: 26, category_id: 7, name: 'NanoCell NANO', description: 'NanoCell —Ç–µ–ª–µ–≤–∏–∑–æ—Ä LG', brand_name: 'LG', category_name: '–¢–µ–ª–µ–≤–∏–∑–æ—Ä' }
      ];
    } else if (brandId === '27') { // Sony —Ç–µ–ª–µ–≤–∏–∑–æ—Ä—ã
      models = [
        { id: 55, brand_id: 27, category_id: 7, name: 'BRAVIA XR A95K', description: 'OLED —Ç–µ–ª–µ–≤–∏–∑–æ—Ä Sony', brand_name: 'Sony', category_name: '–¢–µ–ª–µ–≤–∏–∑–æ—Ä' },
        { id: 56, brand_id: 27, category_id: 7, name: 'BRAVIA XR X95K', description: 'LED —Ç–µ–ª–µ–≤–∏–∑–æ—Ä Sony', brand_name: 'Sony', category_name: '–¢–µ–ª–µ–≤–∏–∑–æ—Ä' }
      ];
    } else if (brandId === '28') { // TCL —Ç–µ–ª–µ–≤–∏–∑–æ—Ä—ã
      models = [
        { id: 57, brand_id: 28, category_id: 7, name: 'C735 QLED', description: 'QLED —Ç–µ–ª–µ–≤–∏–∑–æ—Ä TCL', brand_name: 'TCL', category_name: '–¢–µ–ª–µ–≤–∏–∑–æ—Ä' },
        { id: 58, brand_id: 28, category_id: 7, name: 'P635 LED', description: 'LED —Ç–µ–ª–µ–≤–∏–∑–æ—Ä TCL', brand_name: 'TCL', category_name: '–¢–µ–ª–µ–≤–∏–∑–æ—Ä' }
      ];
    }
  } else {
    // –ï—Å–ª–∏ –±—Ä–µ–Ω–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
    models = [];
  }
  
  res.json(models);
});

app.get('/api/problems', (req, res) => {
  res.json([
    { id: 1, category_id: 1, name: '–ù–µ –∑–∞—Ä—è–∂–∞–µ—Ç—Å—è', description: '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∑–∞—Ä—è–¥–∫–∏', severity: 'high' },
    { id: 2, category_id: 1, name: '–†–∞–∑–±–∏—Ç —ç–∫—Ä–∞–Ω', description: '–¢—Ä–µ—Å–Ω—É–ª –∏–ª–∏ —Ä–∞–∑–±–∏—Ç –¥–∏—Å–ø–ª–µ–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞', severity: 'medium' },
    { id: 3, category_id: 2, name: '–ù–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è', description: '–ù–æ—É—Ç–±—É–∫ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ –ø–∏—Ç–∞–Ω–∏—è', severity: 'critical' },
    { id: 4, category_id: 3, name: '–ù–µ —Å—Ç–∏—Ä–∞–µ—Ç', description: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ü–∏–∫–ª —Å—Ç–∏—Ä–∫–∏', severity: 'high' },
    { id: 5, category_id: 3, name: '–ù–µ –æ—Ç–∂–∏–º–∞–µ—Ç', description: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ –Ω–µ –æ—Ç–∂–∏–º–∞–µ—Ç –±–µ–ª—å–µ', severity: 'medium' },
    { id: 6, category_id: 4, name: '–ù–µ –æ—Ö–ª–∞–∂–¥–∞–µ—Ç', description: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω—É–∂–Ω—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É', severity: 'critical' },
    { id: 7, category_id: 4, name: '–®—É–º–∏—Ç', description: '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ –∏–∑–¥–∞–µ—Ç –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –∑–≤—É–∫–∏', severity: 'low' },
    { id: 8, category_id: 5, name: '–ù–µ –≥—Ä–µ–µ—Ç', description: '–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞ –Ω–µ –Ω–∞–≥—Ä–µ–≤–∞–µ—Ç –ø–∏—â—É', severity: 'high' },
    { id: 9, category_id: 5, name: '–ù–µ –∫—Ä—É—Ç–∏—Ç—Å—è —Ç–∞—Ä–µ–ª–∫–∞', description: '–¢–∞—Ä–µ–ª–∫–∞ –≤ –º–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–µ –Ω–µ –≤—Ä–∞—â–∞–µ—Ç—Å—è', severity: 'medium' },
    { id: 10, category_id: 6, name: '–ù–µ –º–æ–µ—Ç –ø–æ—Å—É–¥—É', description: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞ –Ω–µ –æ—á–∏—â–∞–µ—Ç –ø–æ—Å—É–¥—É', severity: 'high' },
    { id: 11, category_id: 6, name: '–ù–µ —Å—É—à–∏—Ç', description: '–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞ –Ω–µ —Å—É—à–∏—Ç –ø–æ—Å—É–¥—É', severity: 'medium' },
    { id: 12, category_id: 7, name: '–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', description: '–¢–µ–ª–µ–≤–∏–∑–æ—Ä –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É', severity: 'critical' },
    { id: 13, category_id: 7, name: '–ù–µ—Ç –∑–≤—É–∫–∞', description: '–¢–µ–ª–µ–≤–∏–∑–æ—Ä –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∑–≤—É–∫', severity: 'medium' }
  ]);
});

app.get('/api/instructions', (req, res) => {
  res.json([
    {
      id: 1,
      model_id: 1,
      problem_id: 1,
      title: '–ó–∞–º–µ–Ω–∞ —Ä–∞–∑—ä–µ–º–∞ Lightning',
      description: '–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–º–µ–Ω–µ —Ä–∞–∑—ä–µ–º–∞ –∑–∞—Ä—è–¥–∫–∏ iPhone 14',
      difficulty: 'hard',
      estimated_time: '1-2 —á–∞—Å–∞',
      tools_required: ['–û—Ç–≤–µ—Ä—Ç–∫–∞ P2 Pentalobe', '–ü—Ä–∏—Å–æ—Å–∫–∞ –¥–ª—è —ç–∫—Ä–∞–Ω–∞'],
      parts_required: ['–†–∞–∑—ä–µ–º Lightning', '–ö–ª–µ–π –¥–ª—è —ç–∫—Ä–∞–Ω–∞'],
      cost_estimate: 1500.00,
      is_pro_pretent: false,
      model_name: 'iPhone 14',
      problem_name: '–ù–µ –∑–∞—Ä—è–∂–∞–µ—Ç—Å—è',
      brand_name: 'Apple',
      category_name: '–¢–µ–ª–µ—Ñ–æ–Ω'
    },
    {
      id: 2,
      model_id: 19,
      problem_id: 4,
      title: '–ó–∞–º–µ–Ω–∞ –ø–æ–º–ø—ã —Å—Ç–∏—Ä–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã',
      description: '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–º–µ–Ω–µ —Å–ª–∏–≤–Ω–æ–π –ø–æ–º–ø—ã Bosch WAU28PH9',
      difficulty: 'medium',
      estimated_time: '30-45 –º–∏–Ω—É—Ç',
      tools_required: ['–û—Ç–≤–µ—Ä—Ç–∫–∞ –∫—Ä–µ—Å—Ç–æ–≤–∞—è', '–ü–ª–æ—Å–∫–æ–≥—É–±—Ü—ã'],
      parts_required: ['–ü–æ–º–ø–∞ —Å–ª–∏–≤–Ω–∞—è Bosch'],
      cost_estimate: 2500.00,
      is_pro_pretent: true,
      model_name: 'WAU28PH9',
      problem_name: '–ù–µ —Å—Ç–∏—Ä–∞–µ—Ç',
      brand_name: 'Bosch',
      category_name: '–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞'
    }
  ]);
});

app.get('/api/instructions/:id', (req, res) => {
  const instructionId = req.params.id;
  
  // –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
  if (instructionId === '1') {
    res.json({
      id: 1,
      model_id: 1,
      problem_id: 1,
      title: '–ó–∞–º–µ–Ω–∞ —Ä–∞–∑—ä–µ–º–∞ Lightning',
      description: '–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–º–µ–Ω–µ —Ä–∞–∑—ä–µ–º–∞ –∑–∞—Ä—è–¥–∫–∏ iPhone 14',
      difficulty: 'hard',
      estimated_time: '1-2 —á–∞—Å–∞',
      tools_required: ['–û—Ç–≤–µ—Ä—Ç–∫–∞ P2 Pentalobe', '–ü—Ä–∏—Å–æ—Å–∫–∞ –¥–ª—è —ç–∫—Ä–∞–Ω–∞'],
      parts_required: ['–†–∞–∑—ä–µ–º Lightning', '–ö–ª–µ–π –¥–ª—è —ç–∫—Ä–∞–Ω–∞'],
      cost_estimate: 1500.00,
      is_pro_pretent: false,
      model_name: 'iPhone 14',
      problem_name: '–ù–µ –∑–∞—Ä—è–∂–∞–µ—Ç—Å—è',
      brand_name: 'Apple',
      category_name: '–¢–µ–ª–µ—Ñ–æ–Ω',
      steps: [
        {
          step_number: 1,
          title: '–û—Ç–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞',
          description: '–ü–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–∫–ª—é—á–∏—Ç–µ iPhone –∏ –æ—Ç—Å–æ–µ–¥–∏–Ω–∏—Ç–µ –≤—Å–µ –∫–∞–±–µ–ª–∏',
          image_url: null,
          estimated_time: '2 –º–∏–Ω—É—Ç—ã'
        },
        {
          step_number: 2,
          title: '–°–Ω—è—Ç–∏–µ —ç–∫—Ä–∞–Ω–∞',
          description: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏—Å–æ—Å–∫—É –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –∏ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ –ø–æ–¥–Ω–∏–º–∏—Ç–µ –¥–∏—Å–ø–ª–µ–π',
          image_url: null,
          estimated_time: '10 –º–∏–Ω—É—Ç'
        },
        {
          step_number: 3,
          title: '–ó–∞–º–µ–Ω–∞ —Ä–∞–∑—ä–µ–º–∞',
          description: '–û—Ç—Å–æ–µ–¥–∏–Ω–∏—Ç–µ —Å—Ç–∞—Ä—ã–π —Ä–∞–∑—ä–µ–º –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–≤—ã–π',
          image_url: null,
          estimated_time: '30 –º–∏–Ω—É—Ç'
        }
      ]
    });
  } else {
    res.status(404).json({ error: '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' });
  }
});

app.get('/api/partners', (req, res) => {
  res.json([
    {
      id: 1,
      name: '–°–µ—Ä–≤–∏—Å–Ω—ã–π —Ü–µ–Ω—Ç—Ä "–¢–µ—Ö–Ω–æ–ú–∞—Å—Ç–µ—Ä"',
      address: '—É–ª. –õ–µ–Ω–∏–Ω–∞, 123, –ú–æ—Å–∫–≤–∞',
      phone: '+7 (495) 123-45-67',
      rating: 4.8,
      services: ['–†–µ–º–æ–Ω—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤', '–†–µ–º–æ–Ω—Ç –Ω–æ—É—Ç–±—É–∫–æ–≤'],
      working_hours: '–ü–Ω-–ü—Ç: 9:00-18:00, –°–±: 10:00-16:00'
    },
    {
      id: 2,
      name: '–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è "–ë—ã—Å—Ç—Ä—ã–π —Ä–µ–º–æ–Ω—Ç"',
      address: '–ø—Ä. –ú–∏—Ä–∞, 456, –ú–æ—Å–∫–≤–∞',
      phone: '+7 (495) 234-56-78',
      rating: 4.5,
      services: ['–†–µ–º–æ–Ω—Ç –±—ã—Ç–æ–≤–æ–π —Ç–µ—Ö–Ω–∏–∫–∏', '–†–µ–º–æ–Ω—Ç —Ç–µ–ª–µ–≤–∏–∑–æ—Ä–æ–≤'],
      working_hours: '–ü–Ω-–í—Å: 8:00-20:00'
    }
  ]);
});

// WebApp initialization endpoint
app.post('/api/auth/webapp-init', (req, res) => {
  const { initData } = req.body;
  
  // –ü—Ä–æ—Å—Ç–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
  const mockUser = {
    id: 12345,
    first_name: '–¢–µ—Å—Ç–æ–≤—ã–π',
    last_name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
    username: 'testuser',
    is_premium: false
  };
  
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ—Å—Ç–æ–π —Ç–æ–∫–µ–Ω
  const token = 'mock_token_' + Date.now();
  
  res.json({
    success: true,
    token: token,
    user: mockUser
  });
});

// Health check endpoint
app.get('/health', (req, res) => {
  res.json({
    status: 'OK',
    timestamp: new Date().toISOString(),
    version: '1.0.0',
    environment: 'development',
    mode: 'simple (no database)'
  });
});

// Start server
app.listen(PORT, () => {
  console.log(`üöÄ K–ÅLTISON Mini App server running on port ${PORT}`);
  console.log(`üì± WebApp URL: ${process.env.WEBAPP_URL || `http://localhost:${PORT}`}`);
  console.log(`üîß Admin Panel: ${process.env.WEBAPP_URL || `http://localhost:${PORT}`}/admin`);
  console.log(`‚ù§Ô∏è Health Check: ${process.env.WEBAPP_URL || `http://localhost:${PORT}`}/health`);
  console.log(`üéØ Mode: Simple (mock data, no database)`);
  
  if (process.env.NODE_ENV !== 'production') {
    console.log(`üîß Development mode enabled`);
  }
});
